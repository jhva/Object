# 역할, 책임, 협력
> 어플리케이션의 기능을 구현하기 위해 수행하는 상호작용을 **협력**, 협력에 참여하기 위해 수행하는 로직을 **책임**, 협력 안에서 수행하는 책임들이 모여 객체가 수행하는 것을 **역할**을 구성한다.
> 
## 협력 
> 어떤 객체가 다른 객체에게 무엇인가를 요청하는 것이 협력이다. 
- 객체지향 세계에서 유일한 커뮤니케이션 수단인 메시지를 통해 자신의 요청을 전달해라 
  - 메시지를 수신한 객체는 **메서드를** 실행해 요청해 응답해라 
- 자율적인 객체를 위해 상태를 직접관리하고 스스로 결정을 하도록 시켜라  
- 캡슐화를 이용해 자율성을 향상 시켜라
  1. 자율적인 객체는 자신에게 할당된 책임을 수행하던 중에 필요한 정보를 알지 못하거나 외부의 도움이 필요한 경우 적절한 객체에게 메시지를 전송해 협력을 요청한다.
- 객체의 행동은 협력이라는 문맥을 고려해서 정해라 
- 행동이 결정되면 필요한 상태를 넣어라.
- 객체가 참여하는 협력, 즉 문맥에 따라 행동과 상태를 결정지어라

영화 어플리케이션에서 Movie라는 객체가 가지는 행동은 대부분 예매를 위한 협력이다. 예매를 위해 요금 계산을 하는 책임을 갖고있는데, 이때 이 행동에 대해 상태를 결정지어야한다.

_협력은 객체를 구성하는 행동과 상태 모두를 결정하며, 객체를 설계하는 데 필요한 일종의 **문맥을** 제공한다._

## 책임 
> 협력에 참여하기 위해 객체가 수행하는 행동을 **책임이라고** 부른다.
> 
- 객체의 책임은 **'무엇을 알고 있는가'**, **'무엇을 할 수 있는가'** 로 구성해라 
- 객체의 책임은 크게 **하는것과**, **아는것** 두가지 범주로 세분화해서 생각해라
  - 하는 것
    1. 객체를 생성하거나 계산을 수행하는 등의 스스로 하는 것
    2. 다른 객체의 행동을 시작시키는 것
    3. 다른 객체의 활동을 제어하고 조절하는 것
  - 아는것
    1. 시작인 정보에 관해 아는 것
    2. 관련된 객체에 관해 아는 것
    3. 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것 
- 객체지향 설계에서 가장 중요한 것은 **책임이다**. 


### 책임 주도 설계
#### 책임 주도 설계 방법 
- 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다.
- 시스템 책임을 더 작은 책임으로 분할한다.
- 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.
- 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
- 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 된다. 

_**협력은 객체를 설계하기 위한 구체적인 문맥을 제공하고 협력이 책임을 이끌어내면서 책임이 협력에 참여할 객체를 결정한다.**_

### 메시지가 객체를 결정한다.
>객체가 메시지를 선택하는 것이 아닌 메시지가 객체를 선택하게 했다. [Mert12].
- 메시지가 객체를 선택하게 해야 하는 두 가지 중요한 이유 
  - 객체가 최소한의 인터페이스를 가질 수 있음 
  - 객체는 충분히 추상적인 인터페이스를 가질 수 있게 된다
    - 객체의 인터페이스는 무엇을(what) 하는지는 표현해야 하지만 어떻게(how) 수행하는지를 노출해선 안된다.

### 영화 예매 시스템의 경우 협력과 책임에 대한 시스템 설계 
- 영화는 **예매하라**라는 메시지를 통해 설계를 시작하였다. 
- 협력을 위해 예매하라 라는 메시지를 수신할 적절한 객체 Screening을 선택 
- Screening이 가격을 **계산해라** 라는 메시지를 전송해야 한다는 사실을 결정 
- 이후 계산해라 라는 메시지를 수신할 수 있는 객체 Movie를 선택 .
- 이로써 두 객체가 협력하게 됌 .

**_이로써 메시지가 객체를 선택하게 되면 객체는 충분히 추상적이면서 미니멀리즘을 따르는 인터페이스를 가지게 된다._**


### 행동이 상태를 결정한다. 
> **_객체가 존재하는 이유는 협력에 참여하기 위해서이다. 객체는 협력에 필요한 행동을 제공해야하며, 객체를 객체답게 만드는 것은 객체의 상태가 아니라 객체가 다른 객체에게 제공하는 행동이다_**
>
- 객체의 협력에 적합함은 얼마나 적절한 책임을 할당 했고, 책임이 얼마나 적절한지에 따라 달려있다.
- 항상 협력이라는 문맥 안에서 객체를 생각해라.
- 다른 객체로부터 무엇을 얻어야 하는지를 항상 고민해라. 
- 먼저 객체 내부 구현을 하지마라.
- 객체의 행위를 항상 문맥에서 생각해라
- **개별 객체의 상태와 행동이 아닌 시스템의 기능을 구현하기 위한 협력에 초첨을 맞춰라, 이로써 응집도가 높아지며 결합도가 낮은 객체들을 창조할 수 있게 된다.** 
- 객체의 상태는 행동이 결정되면 비로소 결정 된다.

## 역할 
> 어떤 특정한 협력 안에서 수행하는 책임의 집합을 역할이라고 한다.

- 역할은 유연하고 재사용 가능한 협력을 얻을 수 있다. 
- 영화 예매 어플리케이션을 예를 들어보자 

### 유연하고 재사용 가능한 협력 
> 역할은 다른 것으로 교체할 수 있는 책임의 집합이다.
- 일단 역할이라는 개념을 고려하지 않고, 책임만 할당한다고 가정하자.

![스크린샷 2023-11-22 오후 5.46.02.png](%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%205.46.02.png)
- 위에서 보는 거와 같이 Movie가 가격을 계산하기 위해서는 할인 요금이 필요하다 따라서 할인 요금을 계산해라 라는 메시지를 외부의 객체에게 도움을 요청한다.



![스크린샷 2023-11-22 오후 5.46.14.png](%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%205.46.14.png)
- 위 사진에서 영화 예매 도메인에는 금액 할인 정책과 비율 할인 정책 두 가지 할인 정책이 존재해서 AmountDiscountPolicy,PercentDiscountPolicy 두 인스턴스가 필요로 하고 메시지에 
  응답하게 되는데, 그러면 두 인스턴스가 객체의 협력하기 위해 개별적으로 만들면 중복이 일어난다.
- 코드의 중복은 모든 문제의 근원이기 때문에 문제를 해결하기 위해서는 책임에 초점을 맞추고 시작해야 한다
- 해결하기 위해선 어떻게 해야할까? 아래 사진을 보자 

![스크린샷 2023-11-22 오후 5.51.32.png](%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-11-22%20%EC%98%A4%ED%9B%84%205.51.32.png)
- 두 가지 할인 정책은 모두 할인 요금 계산이라는 동일한 책임을 수행하는데, 이때 이 동일한 책임을 하나의 추상클래스 인 DiscountPolicy 로 통합해서 **역할을** 지정해서 사용해라
- 이렇듯 역할을 이용하면 불필요한 중복 코드를 제거하면서, 협력이 더 유연해진다는 점이다. 
- 책임과 역할을 중심으로 **협력**을 바라보는 것이 바로 변경과 확장이 용이한 유연한 설계다.


### 역할의 구현 
- 역할을 구현하는 가장 일반적인 방법은 추상 클래스와 인터페이스를 사용해라
  - 추상 클래스는 책임의 일부만 구현해 놓은 것이다
  - 인터페이스는 일체의 구현 없이 책임만을 나열한 것이다.
- 협력안에서 역할이 어떤 책임을 수행해야 되는지를 결정해라 
- 역할은 객체를 추상화하고 객체 자체가 아닌 협력에 초첨을 맞출 수 있게 해라.

### 객체 대 역할 
- 협력에 참여하는 후보가 여러 종류의 객체에 의해 수행될 필요가 있다면 그 후보는 **역할이** 되지만, 단지 한 종류의 객체만이 협력에 참여할 필요가 있다면 후보는 객체로 만들어라 
  - 협력하는 객체가 많을때 역할을 부여해라. 그게아니면 그냥 객체로 만들어라.
- 설계 초반에 적절한 책임과 협력의 큰 그림을 탐색하는 것을 목표로해라. 
  - 초반에 역할과 객체를 명화게 구분하는 것은 중요치 않고, 필요한 순간으로 부터 역할을 분리해내라

 **_역할의 가장 큰 장점은 설계의 구성 요소를 추상화하면서 유연해지고 재사용이 가능하다는 점이다._** 
 

### 역할과 추상화 
- 추상화는 세부 사항에 억눌리지 않고도 상위 수준의 정책을 쉽고 간단하게 표현할 수 있다. 
- 추상화는 설계를 유연하게 만들고 역할이 다양한 종류의 객체를 끼워 넣을 수 있는 일종의 슬롯이라고 이해해라
- 협력 안에서 역할이라는 추상화를 통해 기존 코드를 수정하지 않고도 새로운 행동을 추가할 수 있다. 
- **협력이라는 문맥 안에서 역할은 협력에 참여해서 책임을 수행하는 객체의 일부다. [Vanhilst96]**
- 역할은 오로지 시스템의 문맥 안에서 무엇을 하는지에 의해서만 정의될 수 있다. 